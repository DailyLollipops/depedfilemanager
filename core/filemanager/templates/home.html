{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'home.css' %}">
    <title>File Manager | Home</title>
</head>

<body>
    <div class="bg-gradient-to-r from-violet-100 to-indigo-100 flex items-center justify-center min-h-screen">
        <div
            class="w-11/12 sm:w-11/12 md:w-8/12 lg:w-6/12 backdrop-blur-sm bg-white/40 p-6 rounded-lg shadow-sm border-violet-200 border">
            <div class="w-full flex justify-between items-center p-3">
                <div class="flex flex-row space-x-4">
                    <a href="/filemanager">
                        <svg fill="#000000" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"
                            class="h-6 fill-black hover:fill-violet-400">
                            <path d="M31.772 16.043l-15.012-15.724c-0.189-0.197-0.449-0.307-0.721-0.307s-0.533 0.111-0.722 0.307l-15.089 15.724c-0.383 0.398-0.369 1.031 0.029 1.414 0.399 0.382 1.031 0.371 1.414-0.029l1.344-1.401v14.963c0 0.552 0.448 1 1 1h6.986c0.551 0 0.998-0.445 1-0.997l0.031-9.989h7.969v9.986c0 0.552 0.448 1 1 1h6.983c0.552 0 1-0.448 1-1v-14.968l1.343 1.407c0.197 0.204 0.459 0.308 0.722 0.308 0.249 0 0.499-0.092 0.692-0.279 0.398-0.382 0.411-1.015 0.029-1.413zM26.985 14.213v15.776h-4.983v-9.986c0-0.552-0.448-1-1-1h-9.965c-0.551 0-0.998 0.445-1 0.997l-0.031 9.989h-4.989v-15.777c0-0.082-0.013-0.162-0.032-0.239l11.055-11.52 10.982 11.507c-0.021 0.081-0.036 0.165-0.036 0.252z"></path>
                        </svg>
                    </a>
                    <h2 class="text-xl font-semibold">Documents</h2>
                </div>
                <button id="openModalBtn"
                    class="flex items-center bg-gradient-to-r from-violet-300 to-indigo-300  border border-fuchsia-00 hover:border-violet-100 text-white font-semibold py-2 px-4 rounded-md transition-colors duration-300">
                    <svg class="w-4 h-4 mr-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <p class="text-white">New Document</p>
                </button>
            </div>
            <div class="w-full flex justify-center p-1 mb-4">
                <form action="/filemanager/search" method="GET" id="search" class="relative w-full">
                    <input type="text" id="query" name="query"
                        class="w-full backdrop-blur-sm bg-white/20 py-2 pl-10 pr-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300"
                        placeholder="Search...">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                        </svg>
                    </div>
                </form>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-4">

                {% if not documents %}
                <p class="text-2xl font-semibold text-gray-900 justify-self-center md:col-span-2 lg:col-span-2">No uploaded documents found...</p>
                {%endif%}

                <!-- Card -->
                {% for document in documents %}
                <div
                    class="backdrop-blur-sm bg-white/20 p-6 rounded-md shadow-sm cursor-pointer border-2 border-gray-50 hover:border-violet-200 hover:border-2 transition-colors duration-300">
                    <h2 class="text-xl font-semibold mb-4">#{{ document.id }} | {{ document.title }}</h2>
                    <p class="text-gray-700 mb-4">{{ document.description }}</p>
                    <p class="text-gray-700 mb-4">Uploaded at: {{document.uploaded_at}}</p>
                    <div class="flex flex-row justify-end space-x-6 sm:mt-4 lg:mt-4 xl:mt-4">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="h-5 stroke-black hover:stroke-violet-200", onclick="openDeleteModal('{{ document.id }}')">
                            <title>Delete Document</title>
                            <path d="M13.5 3H12H8C6.34315 3 5 4.34315 5 6V18C5 19.6569 6.34315 21 8 21H11M13.5 3L19 8.625M13.5 3V7.625C13.5 8.17728 13.9477 8.625 14.5 8.625H19M19 8.625V11.8125" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 16L17.5 18.5M20 21L17.5 18.5M17.5 18.5L20 16M17.5 18.5L15 21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="edit-button h-5 fill-black hover:fill-violet-200", onclick="openEditModal('{{ document.id }}')">
                            <title>Edit Document</title>
                            <path d="M8 18.75H6.5C5.81 18.75 5.25 18.19 5.25 17.5V5.5C5.25 4.81 5.81 4.25 6.5 4.25H10.25V9C10.25 9.41 10.59 9.75 11 9.75H15.8C15.9 10.04 16.17 10.25 16.5 10.25C16.91 10.25 17.25 9.91 17.25 9.5V9C17.25 8.9 17.23 8.8 17.19 8.71C17.15 8.62 17.1 8.54 17.03 8.47L11.53 2.97C11.46 2.9 11.38 2.85 11.29 2.81C11.2 2.77 11.1 2.75 11 2.75H6.5C4.98 2.75 3.75 3.98 3.75 5.5V17.5C3.75 19.02 4.98 20.25 6.5 20.25H8C8.41 20.25 8.75 19.91 8.75 19.5C8.75 19.09 8.41 18.75 8 18.75ZM11.75 5.31L14.69 8.25H11.75V5.31ZM19.61 11.37C19.23 10.99 18.67 10.76 18.09 10.75C17.49 10.72 16.92 10.95 16.54 11.34L10.15 17.74C10.02 17.87 9.95 18.03 9.93 18.21L9.75 20.44C9.73 20.66 9.81 20.88 9.97 21.03C10.11 21.17 10.3 21.25 10.5 21.25C10.52 21.25 10.54 21.25 10.57 21.25L12.82 21.04C12.99 21.02 13.16 20.95 13.28 20.82L19.67 14.42C20.47 13.63 20.44 12.2 19.61 11.37ZM18.61 13.36L12.41 19.57L11.32 19.67L11.4 18.61L17.6 12.4C17.7 12.3 17.88 12.26 18.06 12.25C18.26 12.25 18.44 12.32 18.55 12.43C18.79 12.66 18.82 13.15 18.61 13.36Z"/>
                        </svg>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="h-5 stroke-black hover:stroke-violet-200" onclick="downloadFile('../media/{{ document.file }}', '{{ document.name }}')">
                            <title>Download Document</title>
                            <path d="M13.5 3H12H8C6.34315 3 5 4.34315 5 6V18C5 19.6569 6.34315 21 8 21H12M13.5 3L19 8.625M13.5 3V7.625C13.5 8.17728 13.9477 8.625 14.5 8.625H19M19 8.625V11.8125" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M17.5 15V21M17.5 21L15 18.5M17.5 21L20 18.5" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            class="h-5 stroke-black hover:stroke-violet-200" onclick="window.open('../media/{{ document.file }}', '_blank')">
                            <title>View Document</title>
                            <circle cx="12" cy="12" r="4" fill="#33363F"/>
                            <path d="M21 12C21 12 20 4 12 4C4 4 3 12 3 12" stroke="#33363F" stroke-width="2"/>
                        </svg>
                    </div>
                </div>
                {% endfor %}

            </div>
        </div>
    </div>

    <!-- Add Document Modal -->
    <div id="addModal"
    class="fixed inset-0 top z-10 overflow-hidden backdrop-blur-lg hidden flex items-center justify-center transition-transform duration-300">
        <form action="/filemanager/add" method="POST" enctype="multipart/form-data"
            class="modal-container p-6 backdrop-blur-sm bg-white/90 w-11/12 sm:w-11/12 md:w-8/12 lg:w-6/12 rounded-md shadow-sm">
            {% csrf_token %}
            <h2 class="text-2xl font-semibold mb-6">Add New Document</h2>

            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Document Name</label>
            <input type="text" id="name" name="name" required
                class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">
            
            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Document Title</label>
            <input type="text" id="title" name="title" required
                class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">
            
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
            <textarea type="text" id="description" rows="4" cols="50" name="description" required
            class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300"></textarea>

            <label for="file" class="block text-sm font-medium text-gray-700 mb-2">Attach File</label>
            <input type="file" id="file" name="file" required
                class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">

            <!-- Flex layout for lg and md screens -->
            <!-- <div class="lg:flex">
                <div class="lg:w-1/2 lg:pr-4">
                    <label for="projectDescription"
                        class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <input id="projectDescription"
                        class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300"></input>
                </div>
                <div class="lg:w-1/2">
                    <label for="inviteFriend" class="block text-sm font-medium text-gray-700 mb-2">Invite
                        Friend</label>
                    <input type="text" id="inviteFriend"
                        class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">
                </div>
            </div> -->

            <div class="flex justify-end">
                <button type="submit"
                    class="bg-gradient-to-r from-violet-300 to-indigo-300  border border-fuchsia-00 hover:border-violet-100 text-white font-semibold py-2 px-4 rounded-md mr-2"
                    >Create</button>
                <button type="button"
                    class="bg-gradient-to-r from-gray-100 to-slate-200  border border-fuchsia-00 hover:border-violet-100 text-gray-800 font-semibold py-2 px-4 rounded-md transition-colors duration-300"
                    onclick="closeAddModal()">Cancel</button>
            </div>  
        </form>
    </div>

    <!-- Edit Document Modal -->
    <div id="editModal"
    class="fixed inset-0 top z-10 overflow-hidden backdrop-blur-lg hidden flex items-center justify-center transition-transform duration-300">
        <form action="/filemanager/edit" method="POST" enctype="multipart/form-data"
            class="modal-container p-6 backdrop-blur-sm bg-white/90 w-11/12 sm:w-11/12 md:w-8/12 lg:w-6/12 rounded-md shadow-sm">
            {% csrf_token %}
            <h2 class="text-2xl font-semibold mb-6">Edit Document</h2>
            <input type="text" id="documentID" name="id" class="hidden">

            <label for="documentName" class="block text-sm font-medium text-gray-700 mb-2">Document Name</label>
            <input type="text" id="documentName" name="name" required
                class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">
            
            <label for="documentTitle" class="block text-sm font-medium text-gray-700 mb-2">Document Title</label>
            <input type="text" id="documentTitle" name="title" required
                class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300">
            
            <label for="documentDescription" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
            <textarea type="text" id="documentDescription" rows="4" cols="50" name="description" required
            class="w-full p-2 mb-4 rounded-lg focus:outline-none border-2 border-gray-100 focus:border-violet-300 transition-colors duration-300"></textarea>

            <div class="flex justify-end">
                <button type="submit"
                    class="bg-gradient-to-r from-violet-300 to-indigo-300  border border-fuchsia-00 hover:border-violet-100 text-white font-semibold py-2 px-4 rounded-md mr-2"
                    >Edit</button>
                <button type="button"
                    class="bg-gradient-to-r from-gray-100 to-slate-200  border border-fuchsia-00 hover:border-violet-100 text-gray-800 font-semibold py-2 px-4 rounded-md transition-colors duration-300"
                    onclick="closeEditModal()">Cancel</button>
            </div>  
        </form>
    </div>

    <!-- Delete Document Modal -->
    <div id="deleteModal"
    class="fixed inset-0 top z-10 overflow-hidden backdrop-blur-lg hidden flex items-center justify-center transition-transform duration-300">
        <form action="/filemanager/delete" method="POST" enctype="multipart/form-data"
            class="modal-container p-6 backdrop-blur-sm bg-white/90 w-11/12 sm:w-11/12 md:w-8/12 lg:w-6/12 rounded-md shadow-sm">
            {% csrf_token %}
            <h2 class="text-2xl font-semibold mb-6">Delete Document</h2>
            <input type="text" id="deleteDocumentID" name="id" class="hidden">

            <p class="text-md font-base text-gray-800 mb-6">Deleted document cannot be restored. Are you sure?</p>

            <div class="flex justify-end">
                <button type="submit"
                    class="bg-gradient-to-r from-violet-300 to-indigo-300  border border-fuchsia-00 hover:border-violet-100 text-white font-semibold py-2 px-4 rounded-md mr-2"
                    >Delete</button>
                <button type="button"
                    class="bg-gradient-to-r from-gray-100 to-slate-200  border border-fuchsia-00 hover:border-violet-100 text-gray-800 font-semibold py-2 px-4 rounded-md transition-colors duration-300"
                    onclick="closeDeleteModal()">Cancel</button>
            </div>  
        </form>
    </div>

    <script>
        function openAddModal() {
            document.getElementById("addModal").classList.remove("hidden");
        }

        function closeAddModal() {
            document.getElementById("addModal").classList.add("hidden");
        }

        document.getElementById("openModalBtn").addEventListener("click", openAddModal);

        async function openEditModal(id) {
            response = await fetch("get?id="+id)
            data = await response.json()
            document.getElementById("documentID").value = id;
            document.getElementById("documentName").value = data["name"];
            document.getElementById("documentTitle").value = data["title"];
            document.getElementById("documentDescription").value = data["description"];
            document.getElementById("editModal").classList.remove("hidden");
        }

        function closeEditModal() {
            document.getElementById("editModal").classList.add("hidden");
        }

        function openDeleteModal(id){
            document.getElementById("deleteDocumentID").value = id;
            document.getElementById("deleteModal").classList.remove("hidden");
        }

        function closeDeleteModal(){
            document.getElementById("deleteModal").classList.add("hidden");
        }

        function downloadFile(url, fileName) {
            fetch(url, {
                method: "get",
                mode: "no-cors", // Set the CORS mode (optional)
                referrerPolicy: "no-referrer" // Set the referrer policy (optional)
            })
            .then(response => response.blob())
            .then(blob => {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.click();
            })
            .catch(console.error);
        }
    </script>
</body>

</html>